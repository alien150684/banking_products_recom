# Подготовка виртуальной машины

## Клонирование репозитория

```
git clone https://github.com/alien150684/banking_products_recom.git
```

## Активация виртуального окружения

Создать новое виртуальное окружение можно командой:
```bash
python3.10 -m venv .env_recsys
```

После его инициализации
```bash
source .env_recsys/bin/activate
```

установите в него необходимые Python-пакеты 
```bash
pip install -r requirements.txt
```

установите переменные окружения
```bash
source .env
```

# Разворачивание MLflow 

```bash
source ./mlflow_server/run_mlflow_server.sh
```

# Описание данных

Датасет можно скачать [здесь](https://disk.yandex.com/d/Io0siOESo2RAaA). Он содержит данные о поведении клиентов банка за 1,5 года — на их основе вы предскажете, какие новые продукты купят клиенты. Данные начинаются с 28 января 2015 года и содержат ежемесячные записи о продуктах, которые имеет клиент, например, «кредитная карта», «сберегательный счет» и т. д. Цель: предсказать, какие дополнительные продукты клиент купит в мае 2016 года. Эти продукты представляют собой столбцы с именами ind_(xyz)_ult1, которые идут с 25-ой по 48-ю колонку в обучающих данных.

| Название колонки      | Описание колонки                                                                                                                                                |
|-----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|
| fecha_dato            | Колонка для разделения таблицы                                                                                                                                  |
| ncodpers              | Идентификатор пользователя                                                                                                                                      |
| ind_empleado          | Статус занятости работника:<br>- A — сотрудник<br>- B — бывший сотрудник<br>- F — в социальном отпуске<br>- N — не сотрудник<br>- S — статус не определён       |
| pais_residencia       | Страна резидентства                                                                                                                                             |
| sexo                  | Пол                                                                                                                                                             |
| age                   | Возраст                                                                                                                                                         |
| fecha_alta            | Дата, когда клиент впервые заключил договор в банке                                                                                                             |
| ind_nuevo             | 1, если клиент зарегистрировался за последние 6 месяцев                                                                                                         |
| antiguedad            | Стаж клиента (в месяцах)                                                                                                                                        |
| indrel                | 1 — первичный клиент<br>99 — первичный клиент в течении месяца, но не в конце                                                                                   |
| ult_fec_cli_1t        | Последняя дата, когда клиент был премиальным                                                                                                                    |
| indrel_1mes           | Тип клиента в начале месяца:<br>- 1 — премиальный<br>- 2 — собственник<br>- P — потенциальный<br>- 3 — раньше был премиальным<br>- 4 — раньше был собственником |
| tiprel_1mes           | Тип клиента в начале месяца:<br>- A — активный<br>- I — неактивный<br>- P — бывший<br>- R — потенциальный                                                       |
| indresi               | Если страна проживания совпадает со страной банка                                                                                                               |
| indext                | Если страна рождения клиента отличается от страны банка                                                                                                         |
| conyuemp              | 1, если клиент супруг(а) работника                                                                                                                              |
| canal_entrada         | Канал, по которому пришел пользователь                                                                                                                          |
| indfall               | Индекс актуальности счёта (англ. Deceased index, N/S)                                                                                                           |
| tipodom               | Тип адреса (1 — основной адрес)                                                                                                                                 |
| cod_prov              | Код провинции (адреса клиента)                                                                                                                                  |
| nomprov               | Имя провинции                                                                                                                                                   |
| ind_actividad_cliente | Активность пользователя (1 — активный, 0 — неактивный)                                                                                                          |
| renta                 | Доход домохозяйства                                                                                                                                             |
| segmento              | Сегментация: 1 — VIP, 2 — Обыкновенные 3 — выпускники колледжей                                                                                                 |
| ind_ahor_fin_ult1     | Сберегательный счёт                                                                                                                                             |
| ind_aval_fin_ult1     | Банковская гарантия                                                                                                                                             |
| ind_cco_fin_ult1      | Текущие счета                                                                                                                                                   |
| ind_cder_fin_ult1     | Деривативный счёт                                                                                                                                               |
| ind_cno_fin_ult1      | Зарплатный проект                                                                                                                                               |
| ind_ctju_fin_ult1     | Детский счёт                                                                                                                                                    |
| ind_ctma_fin_ult1     | Особый счёт 3                                                                                                                                                   |
| ind_ctop_fin_ult1     | Особый счёт                                                                                                                                                     |
| ind_ctpp_fin_ult1     | Особый счёт 2                                                                                                                                                   |
| ind_deco_fin_ult1     | Краткосрочный депозит                                                                                                                                           |
| ind_deme_fin_ult1     | Среднесрочный депозит                                                                                                                                           |
| ind_dela_fin_ult1     | Долгосрочный депозит                                                                                                                                            |
| ind_ecue_fin_ult1     | Цифровой счёт                                                                                                                                                   |
| ind_fond_fin_ult1     | Денежный средства                                                                                                                                               |
| ind_hip_fin_ult1      | Ипотека                                                                                                                                                         |
| ind_plan_fin_ult1     | Пенсионный план                                                                                                                                                 |
| ind_pres_fin_ult1     | Кредит                                                                                                                                                          |
| ind_reca_fin_ult1     | Налоговый счёт                                                                                                                                                  |
| ind_tjcr_fin_ult1     | Кредитная карта                                                                                                                                                 |
| ind_valo_fin_ult1     | Ценные бумаги                                                                                                                                                   |
| ind_viv_fin_ult1      | Домашний счёт                                                                                                                                                   |
| ind_nomina_ult1       | Аккаунт для выплаты зарплаты                                                                                                                                    |
| ind_nom_pens_ult1     | Аккаунт для пенсионных обязательств                                                                                                                             |
| ind_recibo_ult1       | Дебетовый аккаунт                                                                                                                                               |

Результаты EDA и моделирования представлены в файле `recommendations.ipynb`.


# Описание сервисов

Для тестирования рекомендательной системы должны быть запущены и параллельно работать три сервиса:
1) сервис выдачи рекомендаций (эндпоинт `/recommendations`);
2) Prometheus, который собирает метрики с эндпоинта `/metrics`;
3) Grafana для визуализации метрик с помощью dashboard'а (см. файл `Monitoring.md`).

Инструкции для запуска и тестирования сервисов находятся в файле `Instructions.md`.
Схема взаимодействия рекомендательного сервиса с Prometheus в файле `services.png`.
Cкриншоты работающих сервисов сохранены в папке `screenshots`.